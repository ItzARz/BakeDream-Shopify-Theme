<style>
  h1,
  h2,
  h3,
  h4,
  a,
  button {
    font-family: var(--font-unbounded), sans-serif;
    font-weight: normal;
    color: var(--onyx);
  }

  h3 {
    font-size: clamp(16px, 20px, 24px);
    font-weight: 500;
    color: var(--onyx);
  }

  p {
    font-family: var(--font-ltcushion), sans-serif;
    font-size: clamp(12px, 16px, 20px);
    color: var(--onyx);
    line-height: 1.2;
    letter-spacing: 0px;
  }

  /* Pricing */
  .product-price {
    font-family: var(--font-unbounded), sans-serif;
    font-size: clamp(12px, 20px, 20px);
    font-weight: 500;
  }
  .price--old {
    text-decoration: line-through;
    opacity: 0.5;
    color: var(--onyx);
  }
  .price--sale {
    color: var(--onyx);
  }

  /* Rating */
  .product-rating {
    display: flex;
    gap: 10px;
    color: var(--onyx);
    margin-bottom: 5px;
    max-width: 120px;
  }
  .product-rating .rated {
    color: var(--onyx);
    fill: var(--onyx);
  }
  .product-rating .unrated {
    opacity: 0.3;
  }

  /* Main Product Styling */
  .main-product {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 60px;
    padding: 200px 10dvw;
    justify-items: center;
    //align-items: center;
  }

  .product-info__image {
    position: relative;
    width: 100%;
    height: fit-content;
    max-width: 550px;
  }

  .product-thumbnails {
    display: flex;
    justify-content: flex-start;
    gap: 10px;
    margin-top: 15px;
    flex-wrap: wrap;
  }

  .product-thumbnails img {
    width: 80px;
    height: 80px;
    object-fit: cover;
    border-radius: 16px;
    cursor: pointer;
    border: 2px solid transparent;
    transition: border 0.3s ease;
  }

  .product-thumbnails img.active {
    border-color: var(--chocolate-cosmos);
  }

  .product-info__content {
    width: fit-content;
    display: flex;
    flex-direction: column;
    gap: 20px;
  }

  .product-info__pricing {
    display: flex;
    gap: 20px;
    text-align: left;
  }

  .product-info__title {
    font-size: 32px;
    font-weight: 500;
    color: var(--onyx);
  }

  .product-info__description p {
    font-size: 16px;
    color: var(--onyx);
  }

  .product-info__allergens {
    display: flex;
    flex-direction: column;
    gap: 10px;
  }

  .product-info__allergens h3 {
    font-size: 16px;
    font-weight: 500;
    color: var(--onyx);
  }

  .product-info__allergens-list {
    list-style: none;
    padding: 0;
    margin: 0;
    display: flex;
    gap: 50px;

    & li {
      font-family: var(--font-ltcushion), sans-serif;
      font-size: 16px;
      color: var(--onyx);
    }
  }

  .product-info__xcontamination {
    display: flex;
    flex-direction: column;
    gap: 10px;

    & h3 {
      font-size: 16px;
      font-weight: 500;
      color: var(--onyx);
    }

    & p {
      font-family: var(--font-ltcushion), sans-serif;
      font-size: 16px;
      color: var(--onyx);
    }
  }

  .product-info__actions {
    display: flex;
    flex-direction: column;
    gap: 20px;
    margin-top: 20px;
  }

  .product-info__pickup {
    display: flex;
    align-items: center;
    gap: 10px;
    background-color: #e3f0e3;
    padding: 10px 30px;
    border-radius: 8px;
    font-family: var(--font-ltcushion), sans-serif;
    font-size: 16px;
    color: var(--onyx);
    width: fit-content;
    border: 1px solid 383838;
  }

  .pickup-availability__dot {
    width: 10px;
    height: 10px;
    background-color: #4caf50; /* verde */
    border-radius: 50%;
  }

  .product-info__quantity-cart {
    display: flex;
    flex-wrap: wrap;
    gap: 20px;
  }

  .quantity-selector {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
  }

  .quantity-btn {
    display: flex;
    justify-content: center;
    align-items: center;
    background: none;
    border: 2px solid var(--onyx);
    padding: 10px;
    border-radius: 32px;
    font-size: 24px;
    cursor: pointer;
    color: var(--onyx);
    transition: background-color 0.3s ease, color 0.3s ease;

    &:hover {
      background-color: var(--onyx);
      color: var(--snow);
    }
  }

  .quantity-input {
    width: 40px;
    text-align: center;
    font-size: 18px;
    border: none;
    background: none;
    pointer-events: none;
    color: var(--onyx);
  }

  .bdbutton {
    display: flex;
    justify-content: center;
    align-items: center;
    padding: clamp(5px, 10px, 15px) clamp(10px, 20px, 30px);
    font-weight: 500;
    text-decoration: none;
    border-radius: 8px;
    gap: 10px;
    border: 2px solid transparent;
    width: fit-content;
    font-size: clamp(12px, 14px, 16px);
    text-decoration: none;
    text-align: center;
    pointer-events: all;
    cursor: pointer;

    &.bdbutton__primary {
      background-color: var(--chocolate-cosmos);
      color: var(--snow);
      transition: transform 0.3s ease;
      border: 3px solid var(--chocolate-cosmos);
      transition: background-color 0.3s ease, color 0.3s ease;
    }

    &.bdbutton__primary:hover {
      color: var(--chocolate-cosmos);
      background-color: var(--old-lace);
    }
    &:disabled {
      cursor: not-allowed;
      pointer-events: none;
      opacity: 0.5;
    }
  }

  .bdbutton__primary.sold-out {
    background-color: var(--chocolate-cosmos);
    color: var(--snow);
    transition: transform 0.3s ease;
    border: 3px solid var(--chocolate-cosmos);
    transition: background-color 0.3s ease, color 0.3s ease;
  }

  .bdbutton__outline {
    background-color: transparent;
    color: var(--onyx);
    border: 3px solid var(--onyx);
    transition: background-color 0.3s ease, color 0.3s ease;
    &:hover {
      color: var(--snow);
      background-color: var(--onyx);
    }
  }

  .quantity-input::-webkit-outer-spin-button,
  .quantity-input::-webkit-inner-spin-button {
    -webkit-appearance: none;
    margin: 0;
  }
  .quantity-input {
    -moz-appearance: textfield;
  }

  separator {
    width: 100%;
    height: 1px;
    background-color: var(--onyx);
    opacity: 0.5;
  }

  .free-delivery-badge {
    position: absolute;
    top: -30px;
    right: -30px;
    width: 90px;
  }

  @media (max-width: 1024px) {
    .main-product {
      grid-template-columns: 1fr; /* Una columna en pantallas pequeñas */
      padding: 100px 10dvw;
      gap: 40px;
    }

    .product-info__image {
      max-width: 100%;
    }
    .product-info__content {
      width: 100%;
    }

    .product-info__quantity-cart {
      align-items: center;
      justify-content: center;
    }

    .bdbutton {
      width: 100%; /* Botones más anchos en móviles */
    }

    .bdbutton__primary {
      padding: clamp(8px, 12px, 16px) clamp(15px, 20px, 25px);
      font-size: clamp(14px, 16px, 18px);
    }

    .product-info__allergens-list {
      flex-wrap: wrap;
      gap: 30px;
    }

    .product-info__pickup {
      padding: 8px 20px;
      font-size: 14px;
      width: 100%;
    }
  }
</style>

<product-info
  id="MainProduct-{{ section.id }}"
  class="section-{{ section.id }}-padding gradient color-{{ section.settings.color_scheme }}"
  data-section="{{ section.id }}"
  data-product-id="{{ product.id }}"
  data-update-url="true"
  data-url="{{ product.url }}"
>
  {% assign variant_images = product.images | where: 'attached_to_variant?', true | map: 'src' %}
  <section class="main-product">
    <div class="product-info__image">
      <img
        id="main-product-image"
        src="{{ product.images.first | image_url: width: '2048' , height: '2048' }}"
        alt="{{ product.title }}"
        {% if section.settings.image_zoom == 'hover' %}
          data-zoom-image="{{ product.images.first | image_url: width: '2048' , height: '2048' }}"
        {% endif %}
        width="100%"
        height="100%"
        loading="lazy"
        style="border-radius: 16px;border: 0.5px solid #828689;"
      >
      <img
        class="free-delivery-badge"
        src="{{ 'free-delivery-badge.png' | asset_url }}"
        alt="Bake Dream NY offers free delivery if you order 7+ cookies"
        loading="lazy"
      >
      <!-- Miniaturas debajo -->
      <div class="product-thumbnails">
        {% for image in product.images %}
          <img
            src="{{ image | image_url: width: '150', height: '150' }}"
            alt="{{ product.title }} Thumbnail {{ forloop.index }}"
            class="thumbnail {% if forloop.first %}active{% endif %}"
            data-full="{{ image | image_url: width: '2048', height: '2048' }}"
          >
        {% endfor %}
      </div>
    </div>
    <div class="product-info__content">
      {% if product.available == true %}
        <div class="product-info__pickup">
          <span class="pickup-availability__dot"></span>
          {% assign pickup_location = shop.locations | where: 'pickup', true | first %}
          {% if pickup_location %}
            Available for pickup at {{ pickup_location.address1 }}
          {% else %}
            Available for pickup at 9202 Jamaica Ave
          {% endif %}
        </div>
      {% endif %}
      <div class="product-info__pricing">
        {% if product.compare_at_price > product.price %}
          <span class="product-price price--old">{{ product.compare_at_price | money }}</span>
          <span class="product-price price--sale">{{ product.price | money }}</span>
        {% else %}
          <span class="product-price price--sale">{{ product.price | money }}</span>
        {% endif %}
      </div>
      <h2 class="product-info__title">{{ product.title | strip_html }}</h2>
      <div class="product-rating">
        {% assign rating = product.metafields.custom.rating | plus: 0 %}
        {% for i in (1..5) %}
          {% if i <= rating %}
            <i data-lucide="star" class="rated"></i>
          {% else %}
            <i data-lucide="star" class="unrated"></i>
          {% endif %}
        {% endfor %}
      </div>
      {% if product.description %}
        <div class="product-info__description">
          <p>{{ product.description | strip_html }}</p>
        </div>
      {% endif %}
      <div class="product-info__allergens">
        <h3>Allergens:</h3>
        <ul class="product-info__allergens-list">
          {% if product.metafields.shopify['allergen-information'].value != blank %}
            {% for allergen in product.metafields.shopify['allergen-information'].value %}
              <li>{{ allergen.label }}</li>
            {% endfor %}
          {% else %}
            <li>No allergens listed</li>
          {% endif %}
        </ul>
      </div>
      <div class="product-info__xcontamination">
        <h3>Cross-Contamination</h3>
        <p>Although we apply strict measures to prevent cross-contamination, we cannot guarantee its total absence.</p>
      </div>
      <div class="product-info__actions">
        <separator></separator>
        <form method="post" action="/cart/add" id="product-form">
          <div class="product-info__quantity-cart">
            {%- assign cart_qty = cart | item_count_for_variant: product.selected_or_first_available_variant.id -%}
            {% if product.available == true %}
              <div class="quantity-selector">
                <button type="button" class="quantity-btn" onclick="decreaseQuantity()">
                  <i data-lucide="minus"></i>
                </button>
                <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}">
                <input
                  type="number"
                  id="Quantity-{{ section.id }}"
                  name="quantity"
                  class="quantity-input"
                  data-cart-quantity="{{ cart_qty }}"
                  min="3"
                  value="3"
                  readonly
                >
                <button type="button" class="quantity-btn" onclick="increaseQuantity()">
                  <i data-lucide="plus"></i>
                </button>
              </div>
              <button type="submit" name="add" class="bdbutton bdbutton__primary">
                add to cart <i data-lucide="cookie"></i>
              </button>
              <button type="button" onclick="buyNow()" class="bdbutton bdbutton__outline">
                buy it now <i data-lucide="cookie"></i>
              </button>
            {% else %}
              <button
                class="bdbutton bdbutton__primary {% unless product.available %}sold-out{% endunless %}"
                type="button"
                {% unless product.available %}
                  disabled
                {% endunless %}
              >
                sold out <i data-lucide="frown"></i>
              </button>
            {% endif %}
          </div>
        </form>
      </div>

      {% liquid
        assign share_url = product.selected_variant.url | default: product.url | prepend: request.origin
        render 'share-button', block: block, share_link: share_url
      %}
    </div>
    <script type="application/ld+json">
      {{ product | structured_data }}
    </script>
  </section>
</product-info>
<script>
  function buyNow() {
    const form = document.getElementById('product-form');
    const formData = new FormData(form);

    fetch('/cart/add.js', {
      method: 'POST',
      body: formData,
    })
      .then(function (response) {
        if (!response.ok) {
          throw new Error('An error occurred when we tried to add the item to the cart');
        }
        return response.json();
      })
      .then(function (data) {
        window.location.href = '/checkout';
      })
      .catch(function (error) {
        console.error('Error:', error);
      });
  }

  function increaseQuantity() {
    let quantityInput = document.getElementById('Quantity-{{ section.id }}');
    quantityInput.value = parseInt(quantityInput.value) + 1;
  }

  function decreaseQuantity() {
    let quantityInput = document.getElementById('Quantity-{{ section.id }}');
    if (parseInt(quantityInput.value) > 3) {
      quantityInput.value = parseInt(quantityInput.value) - 1;
    }
  }

  document.addEventListener('DOMContentLoaded', function () {
    const mainImage = document.getElementById('main-product-image');
    const thumbnails = document.querySelectorAll('.product-thumbnails img');

    thumbnails.forEach((thumbnail) => {
      thumbnail.addEventListener('click', function () {
        mainImage.src = this.dataset.full;
        thumbnails.forEach((t) => t.classList.remove('active'));
        this.classList.add('active');
      });
    });
  });
</script>
